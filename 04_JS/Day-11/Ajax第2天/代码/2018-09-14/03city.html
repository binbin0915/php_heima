<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>

<select id="sheng">
    <option value="0">--请选择省--</option>
</select>

<select id="shi">
    <option value="0">--请选择市--</option>
</select>

<select id="xian">
    <option value="0">--请选择县--</option>
</select>

<script>
    /***************** 封装函数 *********************/
    /*
    参数 res 是要处理的数据
    参数 ele 把处理好的数据放到ele里面
    */
    function chuli(res, ele){
        for(var i in res){
            var option = document.createElement('option');
            option.setAttribute('value', res[i].id);
            option.innerText = res[i].cn_name;
            ele.appendChild(option);
        }
    }
    /*
    参数 元素的id
    返回值 元素的dom对象
    */
    function $(id){
        return document.getElementById(id);
    }
    /*
    url  请求的地址，带参数
    fn  函数类型，函数的参数是要处理的数据
    */
    function get(url, fn){
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function(){
            if(xhr.readyState==4 && xhr.status==200){
                var res = JSON.parse(xhr.responseText); //返回的数据
                fn(res); //处理返回的数据
            }
        };
        xhr.open('get', url, true);
        xhr.send();
    }
    /************************ 页面加载完毕，获取省 *********************************/
    get('03city.php', function(data){
        chuli(data, $('sheng'));
    });

    /************************ 省切换的时候，获取市 *********************************/
    $('sheng').onchange = function () {
        //省切换的时候，要获取id值，即option的value值
        var id = this.value; //类似于 105
        get('03city.php?filename='+id, function(data){
            //重置市
            $('shi').innerHTML = '<option value="0">--请选择市--</option>';
            //重置县
            $('xian').innerHTML = '<option value="0">--请选择县--</option>';
            chuli(data, $('shi'));
        });
    };

    /************************ 切换市，获取县 *********************************/
    $('shi').onchange = function () {
        //市切换的时候，要获取id值，即option的value值
        var id = this.value; //类似于 130000
        get('03city.php?filename='+id, function (data) {
            //重置县
            $('xian').innerHTML = '<option value="0">--请选择县--</option>';
            chuli(data, $('xian'));
        });
    };
</script>

</body>
</html>